<html>
    <head>
        <title>Helios Node</title>
        <link rel="icon" type="image/png" href="favicon.png">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link rel="stylesheet" href="style.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <div class="sidebar"></div>
        <div class="main-content" style="display: none">
            <div class="container">
                <div id="wallet-container" class="wallet-grid">
                    <div class="wallet-card">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="material-icons">account_balance_wallet</i>
                                <span>Wallet</span>
                            </div>
                        </div>
                        
                        <!-- Message Container -->
                        <div id="message-container" class="message-container"></div>
                        
                        <!-- Balance Section -->
                        <div class="balance-section">
                            <div class="balance-title">
                                <i class="material-icons">account_balance</i>
                                Current Balance
                            </div>
                            <div class="balance-amount" id="wallet-balance">0.00 HLS</div>
                        </div>

                        <!-- Address Section -->
                        <div class="address-section">
                            <div class="address-title">
                                <i class="material-icons">account_circle</i>
                                Wallet Address
                            </div>
                            <div class="address-display">
                                <span class="address-text" id="wallet-address">0x1234567890abcdef1234567890abcdef12345678</span>
                                <button class="copy-button" onclick="copyWalletAddress()">
                                    <i class="material-icons">content_copy</i>
                                </button>
                            </div>
                        </div>

                        <!-- Transfer Section -->
                        <div class="transfer-section">
                            <div class="transfer-title">
                                <i class="material-icons">send</i>
                                Send Transaction
                            </div>
                            
                            <div class="form-group">
                                <label for="wallet-address-to">Destination Address</label>
                                <input type="text" 
                                       id="wallet-address-to" 
                                       placeholder="Enter destination address (0x...)" />
                            </div>

                            <div class="form-group">
                                <label for="amount-to">Amount (HLS)</label>
                                <input type="number" 
                                       id="amount-to" 
                                       placeholder="Enter amount to send" 
                                       min="0" 
                                       step="0.000001" />
                            </div>

                            <div class="action-buttons">
                                <button class="send-button" onclick="sendAction()">
                                    <i class="material-icons">send</i>
                                    <span>Send Transaction</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            let password = window.localStorage.getItem("access-code");

            function showMessage(message, type) {
                const messageContainer = document.getElementById('message-container');
                messageContainer.textContent = message;
                messageContainer.className = `message-container ${type}`;
                messageContainer.style.display = 'block';
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    messageContainer.style.display = 'none';
                }, 5000);
            }

            function copyWalletAddress() {
                const addressText = document.getElementById('wallet-address').textContent;
                navigator.clipboard.writeText(addressText).then(() => {
                    const copyButton = document.querySelector('.copy-button');
                    const originalContent = copyButton.innerHTML;
                    
                    copyButton.innerHTML = '<i class="material-icons">check</i>';
                    copyButton.style.background = 'rgba(46, 204, 113, 0.2)';
                    copyButton.style.borderColor = 'rgba(46, 204, 113, 0.3)';
                    copyButton.style.color = '#2ECC71';
                    
                    setTimeout(() => {
                        copyButton.innerHTML = originalContent;
                        copyButton.style.background = '';
                        copyButton.style.borderColor = '';
                        copyButton.style.color = '';
                    }, 2000);
                });
            }

            async function sendAction() {
                const amount = document.getElementById('amount-to').value;
                const addressTo = document.getElementById('wallet-address-to').value;
                
                if (!amount || amount <= 0) {
                    showMessage("Please enter a valid amount", "error");
                    return;
                }
                
                if (!addressTo || addressTo.trim() === '') {
                    showMessage("Please enter a valid destination address", "error");
                    return;
                }
                
                // Basic address validation
                if (!addressTo.startsWith('0x') || addressTo.length !== 42) {
                    showMessage("Please enter a valid Ethereum-style address (0x...)", "error");
                    return;
                }
                
                const walletPassword = await new Promise((resolve) => {
                    try {
                        pw_prompt({
                            lm: "Please enter your wallet password:", 
                            callback: function(password) {
                                resolve(password);
                            }
                        });
                    } catch (e) {
                        resolve('');
                    }
                });
                
                if (!walletPassword) {
                    showMessage("Password is required", "error");
                    return;
                }
                
                const walletData = {
                    to: addressTo,
                    amount: amount
                };
                
                const result = await apiWalletTransfer(walletPassword, walletData);
                if (result === undefined) {
                    showMessage("Error during transfer", "error");
                    return;
                }
                
                showMessage(`Transfer successful! Transaction hash: ${result}`, "success");
                
                // Clear form
                document.getElementById('amount-to').value = '';
                document.getElementById('wallet-address-to').value = '';
                
                // Refresh wallet info
                const wallet = await apiGetWalletInfo();
                if (wallet) {
                    document.getElementById('wallet-balance').textContent = `${wallet.balance} HLS`;
                }
            }

            const main = async () => {
                if (password == undefined) {
                    window.location = '/';
                    return ;
                }
                if (!(await isSetup())) {
                    window.location = '/setup';
                    return ;
                }
                displaySideBar();
                document.querySelectorAll('.main-content')[0].style.display = '';

                const wallet = await apiGetWalletInfo();
                if (wallet) {
                    document.getElementById('wallet-address').textContent = wallet.address;
                    document.getElementById('wallet-balance').textContent = `${wallet.balance} HLS`;
                }
            }

            window.addEventListener('DOMContentLoaded', async (event) => {
                await main();
            });
        </script>
        <script src="js/side-bar.js"></script>
        <script src="js/utils.js"></script>
        <script src="js/api.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    </body>
</html>